# 教育机构CRM系统增强文档

本文档详细说明了CRM系统的数据库增强功能，包括新增的表结构、视图和查询示例。

## 项目总览

完整的数据库结构与开发参考请见：`PROJECT_OVERVIEW.md`
ER 图与字段字典：`ERD.mmd`、`DATA_DICTIONARY.csv`

## 核心功能增强

### 1. 学生表现追踪
- 新增 `student_performance` 表
- 记录出勤率、课堂参与度、行为评分
- 支持教师评语和定期评估

### 2. 作业管理系统
- 新增 `homework_assignments` 表
- 关联群聊消息ID，方便追踪作业布置情况
- 完整的作业提交状态跟踪

### 3. 教师专长管理
- 新增 `teacher_specializations` 表
- 记录教师专业领域和级别
- 便于合理分配教学资源

### 4. 班级课程表
- 新增 `class_schedule` 表
- 灵活的时间段设置
- 支持课程有效期管理

### 5. 考勤系统
- 新增 `student_attendance` 表
- 详细的出勤状态记录
- 关联课程表自动化管理

## 数据视图

### 1. 家长沟通视图 (v_parent_communications)
- 整合群聊和私聊记录
- 自动筛选近6个月通讯记录
- 关联学生和班级信息

### 2. 学生表现总结视图 (v_student_performance_summary)
- 汇总作业完成情况
- 平均出勤率和表现评分
- 积分和标签系统集成

### 3. 班级表现总结视图 (v_class_performance_summary)
- 班级整体表现指标
- 作业完成统计
- 学生出勤概况

## 常用查询示例

### 1. 学生综合信息查询
```sql
-- 见 example_queries.sql 示例1
-- 包含：基本信息、表现评估、任课教师专长、课程表
```

### 2. 作业完成情况
```sql
-- 见 example_queries.sql 示例2
-- 包含：作业提交状态、得分、是否逾期
```

### 3. 家长沟通记录
```sql
-- 见 example_queries.sql 示例3
-- 包含：群聊和私聊记录、时间线
```

### 4. 学生考勤记录
```sql
-- 见 example_queries.sql 示例4
-- 包含：出勤状态、课程信息、记录教师
```

## 性能优化

### 1. 索引优化
- 学生表现查询优化
- 作业相关查询优化
- 课程表查询优化
- 考勤记录查询优化

### 2. 视图优化
- 预计算常用统计数据
- 优化关联查询性能
- 自动数据聚合

## 标签系统使用建议

在 students 表的 profile_tags JSONB 字段中，建议包含以下类型的标签：

```json
{
  "learning_style": "视觉型",
  "special_needs": ["需要额外辅导"],
  "interests": ["数学竞赛", "编程"],
  "parent_preference": "微信沟通",
  "payment_status": "正常",
  "risk_level": "低",
  "custom_tags": ["重点关注", "优秀学员"]
}
```

## 使用指南

1. 执行 schema_enhancement.sql 创建新的表结构和视图
2. 参考 example_queries.sql 中的示例进行数据查询
3. 根据业务需求适当调整查询参数

## 注意事项

1. 定期维护学生表现记录
2. 及时更新课程表信息
3. 保持标签系统的规范使用
4. 定期检查家长沟通情况
5. 关注学生转班对表现的影响

## 未来优化方向

1. 添加学生目标追踪系统
2. 增强家长反馈机制
3. 整合学习资源管理
4. 开发教师工作量分析
5. 优化班级资源分配
